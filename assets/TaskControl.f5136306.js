import{r as h,G as d,H as u,P as n,$ as g,J as m,ae as C,Q as v}from"./index.be909082.js";import{a as l}from"./user.b8106082.js";const F=n("button",{type:"submit"},"\u4E0A\u50B3\u6587\u4EF6",-1),E=n("h5",null,"\u5DF2\u4E0A\u50B3\u7684\u6A94\u6848",-1),D=["href"],L=["onClick"],$=["onClick"],N={__name:"TaskControl",setup(B){const s=h(null),f=h([]),_=()=>{s.value.files.length>0},w=async()=>{const e=s.value.files[0],o=new FormData;o.append("file",e);try{const t=await l.post("/task/upload",o,{headers:{"Content-Type":"multipart/form-data"}});alert("\u4E0A\u50B3\u6210\u529F"),await i(),console.log("File uploaded:",t.data)}catch(t){alert("\u4E0A\u50B3\u5931\u6557"),console.error("Error uploading file:",t)}},k=async e=>{try{const o=await l.get(`/task/${e}`,{responseType:"blob"});let t="downloaded_file";const a=o.headers["content-disposition"];if(console.log(a),a){const c=a.match(/filename=([^;]+)/);c&&c[1]&&(t=c[1])}const p=window.URL.createObjectURL(new Blob([o.data])),r=document.createElement("a");r.href=p,r.setAttribute("download",t),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(p),alert("\u4E0B\u8F7D\u6210\u529F")}catch(o){console.error("\u4E0B\u8F7D\u6587\u4EF6\u65F6\u51FA\u9519:",o)}},y=e=>{confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6A94\u6848 \uFF1F")&&b(e._id)},b=async e=>{try{await l.delete(`/task/${e}`),alert("\u522A\u9664\u6210\u529F"),await i()}catch(o){throw new Error("Error deleting file:",o)}},i=async()=>{try{const e=await l.get("/task/files");f.value=e.data}catch(e){console.error("Error fetching uploaded files:",e)}};return i(),(e,o)=>(d(),u(m,null,[n("div",null,[n("form",{onSubmit:g(w,["prevent"])},[n("input",{type:"file",ref_key:"fileInput",ref:s,onChange:_},null,544),F],32)]),n("div",null,[E,n("ul",null,[(d(!0),u(m,null,C(f.value,t=>(d(),u("li",{key:t._id},[n("a",{href:t.filePath,target:"_blank"},v(t.fileName),9,D),n("button",{onClick:a=>k(t._id)},"\u4E0B\u8F09",8,L),n("button",{onClick:a=>y(t)},"\u522A\u9664",8,$)]))),128))])])],64))}};export{N as default};
